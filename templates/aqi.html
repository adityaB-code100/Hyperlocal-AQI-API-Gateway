{% extends "base.html" %}
{% block content %}

  <!-- HEADER -->
  <div class="header relative bg-gradient-to-r from-indigo-600 to-indigo-500 text-white py-10 mb-8 text-center overflow-hidden dark:from-indigo-700 dark:to-indigo-800">
    <div class="container mx-auto px-4">
      <h1 class="text-4xl font-bold mb-2 relative animate-fadeIn">üåç Hyperlocal AQI ‚Äì {{village}}</h1>
      <p class="text-lg animate-fadeIn" style="animation-delay: 0.2s">Real-time AQI Predictions for Rural & Underserved Areas</p>
      <div class="mt-4 animate-fadeIn" style="animation-delay: 0.4s">
        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-white bg-opacity-20 backdrop-blur-sm">
          <span class="w-2 h-2 rounded-full bg-green-400 mr-2 animate-pulse"></span>
          System Status: {{date}}  <span class="ml-1 font-semibold">Live</span>
        </span>
      </div>
    </div>
  </div>


<div class="m-10">
<div class="container mx-auto px-4 mb-6 w-full">
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 text-center hover-lift animate-fadeIn">
    <h2 class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">
      üìç Selected Village: <span class="text-gray-900 dark:text-white">{{village}}</span>
    </h2>
  </div>
</div>

  <form action="/" method="post" onsubmit="return validateForm()">
  <div class="container mx-auto px-4 w-full">
    <!-- VILLAGE + DATE FILTER -->
    <div class="card bg-white rounded-2xl shadow-lg mb-6 p-6 animate-fadeIn dark:bg-gray-800 hover-lift">
      <h5 class="card-title text-lg font-semibold mb-4 flex items-center">
        <i class="fas fa-filter mr-2 text-indigo-600 dark:text-indigo-400"></i> Select Village & Date
      </h5>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Village Dropdown -->
        <div>
          <label class="form-label block text-sm font-medium text-gray-700 mb-1 dark:text-gray-300">Village</label>
          <select name="village" id="village" 
            class="form-select w-full rounded-xl py-3 px-4 border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-indigo-400 dark:focus:border-indigo-400"
            required>
            <option value="" disabled selected>{{village}}</option>
            <option value="Nanded">Nanded</option>
            <option value="Pune">Pune</option>
            <option value="Mumbai">Mumbai</option>
            <option value="Nagpur">Nagpur</option>
            <option value="Nashik">Nashik</option>  
          </select>
        </div>

        <!-- Date Picker -->
        <div class="mb-4">
          <label for="date" class="form-label block text-sm font-medium text-gray-700 mb-1 dark:text-gray-300" >
            Date
          </label>
          <div class="relative">
            <input 
              type="date" 
              id="date" 
              name="date" 
              class="form-control w-full rounded-xl py-3 pl-10 pr-4 
                     border border-gray-300 shadow-sm 
                     hover:border-indigo-400 
                     focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 
                     dark:bg-gray-700 dark:border-gray-600 dark:text-white 
                     dark:focus:ring-indigo-400 dark:focus:border-indigo-400
                     transition duration-200 ease-in-out"
              required
            >
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <button type="submit" 
        class="btn-primary mt-4 bg-gradient-to-r from-indigo-600 to-indigo-500 text-white font-semibold py-2 px-6 rounded-xl shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300 animate-pulse dark:from-indigo-500 dark:to-indigo-400 flex items-center justify-center">
        <i class="fas fa-sync-alt mr-2"></i> Apply Filters
      </button>
    </div>
  </div>
</form>



<!-- MAP -->
<div class="h-96 rounded-2xl shadow-lg mb-5 animate-fadeIn hover-lift relative ">
  <iframe src="{{ url_for('static', filename='map' + date + '.html') }}" 
          class="w-full h-full rounded-2xl border-0">
  </iframe>
  <!-- <div class="w-full h-[600px] rounded-2xl border-0">
    {{ map|safe }}
</div>
 -->

  <!-- AQI Scale -->
  <div class="absolute bottom-3 right-3 bg-white dark:bg-gray-800 shadow-md rounded-lg p-3 text-sm">
    <h3 class="font-semibold mb-2 text-gray-800 dark:text-gray-200">AQI Scale</h3>
    <div class="space-y-1">
      <div class="flex items-center">
        <span class="w-5 h-5 rounded-sm bg-green-500 mr-2"></span>
        <span class="text-gray-700 dark:text-gray-300">Good (0‚Äì50)</span>
      </div>
      <div class="flex items-center">
        <span class="w-5 h-5 rounded-sm bg-yellow-400 mr-2"></span>
        <span class="text-gray-700 dark:text-gray-300">Moderate (51‚Äì100)</span>
      </div>
      <div class="flex items-center">
        <span class="w-5 h-5 rounded-sm bg-orange-500 mr-2"></span>
        <span class="text-gray-700 dark:text-gray-300">Unhealthy-Sensitive (101‚Äì150)</span>
      </div>
      <div class="flex items-center">
        <span class="w-5 h-5 rounded-sm bg-red-500 mr-2"></span>
        <span class="text-gray-700 dark:text-gray-300">Unhealthy (151‚Äì200)</span>
      </div>
      <div class="flex items-center">
        <span class="w-5 h-5 rounded-sm bg-purple-600 mr-2"></span>
        <span class="text-gray-700 dark:text-gray-300">Very Unhealthy (201‚Äì300)</span>
      </div>
      <div class="flex items-center">
        <span class="w-5 h-5 rounded-sm bg-gray-900 mr-2"></span>
        <span class="text-gray-700 dark:text-gray-300">Hazardous (301+)</span>
      </div>
    </div>
  </div>
</div>


    <!-- AQI SUMMARY CARDS -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-5 text-center mb-6">
      <div class="aqi-card bg-white p-6 rounded-2xl shadow-lg animate-fadeIn hover-lift dark:bg-gray-800">
        <h5 class="text-lg font-medium flex items-center justify-center">
          <i class="fas fa-broadcast-tower mr-2 text-indigo-600 dark:text-indigo-400"></i> Live Air Quality Index {{village}}
        </h5>
        <div class="aqi-value text-4xl font-extrabold bg-clip-text text-transparentmt-2
        {% if live_AQI <= 50 %} text-green-500  good-aqi 
        {% elif live_AQI <= 100 %} text-yellow-500 moderate-aqi
        {% elif live_AQI <= 200 %} text-orange-500 poor-aqi 
        {% else %} text-red-600 poor-aqi 
        {% endif %}">{{live_AQI}}</div> 
        <div class="aqi-percentage h-1.5 bg-gray-200 rounded-full my-3 overflow-hidden dark:bg-gray-700">
        <div class="aqi-percentage-fill h-full rounded-full 
          {% if live_AQI <= 50 %} bg-green-500 
          {% elif live_AQI <= 100 %} bg-yellow-500 
          {% elif live_AQI <= 200 %} bg-orange-500 
          {% else %} bg-red-600 
          {% endif %}" 
          style="width: 45%;">
        </div>
        </div>
        <p class="text-gray-500 mt-2 dark:text-gray-400"> 
          {% if avg_aqi_7_days <= 50 %} Good
              {% elif live_AQI <= 100 %} Moderate
              {% elif live_AQI <= 200 %} Unhealthy
              {% else %} Very Unhealthy
              {% endif %} air quality</p>
       
      </div>
      <div class="aqi-card bg-white p-6 rounded-2xl shadow-lg animate-fadeIn hover-lift dark:bg-gray-800">
        <h5 class="text-lg font-medium flex items-center justify-center">
          <i class="fas fa-chart-line mr-2 text-indigo-600 dark:text-indigo-400"></i> 7-Day Average AQI </h5>
        <div class="aqi-value text-4xl font-extrabold bg-clip-text text-transparentmt-2
        {% if avg_aqi_7_days <= 50 %} text-green-500  good-aqi 
        {% elif avg_aqi_7_days <= 100 %} text-yellow-500 moderate-aqi
        {% elif avg_aqi_7_days <= 200 %} text-orange-500 poor-aqi 
        {% else %} text-red-600 poor-aqi 
        {% endif %}">{{avg_aqi_7_days}}</div> 
        <div class="aqi-percentage h-1.5 bg-gray-200 rounded-full my-3 overflow-hidden dark:bg-gray-700">
        <div class="aqi-percentage-fill h-full rounded-full 
          {% if avg_aqi_7_days <= 50 %} bg-green-500 
          {% elif avg_aqi_7_days <= 100 %} bg-yellow-500 
          {% elif avg_aqi_7_days <= 200 %} bg-orange-500 
          {% else %} bg-red-600 
          {% endif %}" 
          style="width: 45%;">
        </div>
        </div>
        <p class="text-gray-500 mt-2 dark:text-gray-400"> 
          {% if avg_aqi_7_days <= 50 %} Good
              {% elif avg_aqi_7_days <= 100 %} Moderate
              {% elif avg_aqi_7_days <= 200 %} Unhealthy
              {% else %} Very Unhealthy
              {% endif %} air quality</p>
       
      </div>

      <div class="aqi-card bg-white p-6 rounded-2xl shadow-lg animate-fadeIn hover-lift dark:bg-gray-800" style="animation-delay: 0.1s">
        <h5 class="text-lg font-medium flex items-center justify-center">
          <i class="fas fa-exclamation-triangle mr-2 text-amber-600 dark:text-amber-400 "></i> Worst AQI
        </h5>
        <div class="aqi-value text-4xl font-extrabold bg-clip-text text-transparent  mt-2
        {% if worst_aqi <= 50 %} text-green-500  good-aqi 
        {% elif worst_aqi <= 100 %} text-yellow-500 moderate-aqi
        {% elif worst_aqi <= 200 %} text-orange-500 poor-aqi 
        {% else %} text-red-600 poor-aqi 
        {% endif %}">{{worst_aqi}}</div> 
        <div class="aqi-percentage h-1.5 bg-gray-200 rounded-full my-3 overflow-hidden dark:bg-gray-700">
          <div class="aqi-percentage-fill h-full rounded-full   {% if worst_aqi <= 50 %} bg-green-500 
          {% elif worst_aqi <= 100 %} bg-yellow-500 
          {% elif worst_aqi <= 200 %} bg-orange-500 
          {% else %} bg-red-600 
          {% endif %}" style="width: 78%; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);"></div>
        </div>
        <p class="text-gray-500 mt-2 dark:text-gray-400">Worst On {{  avg_3card_dict['worst_aqi']}}</p>
        
      </div>


      <div class="aqi-card bg-white p-6 rounded-2xl shadow-lg animate-fadeIn hover-lift dark:bg-gray-800" style="animation-delay: 0.2s">
        <h5 class="text-lg font-medium flex items-center justify-center">
          <i class="fas fa-trophy mr-2 text-emerald-600 dark:text-emerald-400"></i> Lowest AQI
        </h5>
         <div class="aqi-value text-4xl font-extrabold bg-clip-text text-transparent  mt-2
        {% if best_aqi <= 50 %} text-green-500  good-aqi 
        {% elif best_aqi <= 100 %} text-yellow-500 moderate-aqi
        {% elif best_aqi <= 200 %} text-orange-500 poor-aqi 
        {% else %} text-red-600 poor-aqi 
        {% endif %}">{{best_aqi}}</div> 
        <div class="aqi-percentage h-1.5 bg-gray-200 rounded-full my-3 overflow-hidden dark:bg-gray-700">
          <div class="aqi-percentage-fill h-full rounded-full   {% if best_aqi <= 50 %} bg-green-500 
          {% elif best_aqi <= 100 %} bg-orange-500 
          {% elif best_aqi <= 200 %} bg-red-500 
          {% else %} bg-red-600 
          {% endif %}" 

                    {% if best_aqi <= 50 %} style="width:30%; background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%);"
            {% elif best_aqi <= 100 %}
             style="width:55%; background: linear-gradient(135deg, #FACC15 0%, #EAB308 100%);"
            {% elif best_aqi <= 200 %}  style="width:75%; background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);"
            {% elif best_aqi <= 300 %}
               style="width:90%; background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);"
            {% elif best_aqi <= 400 %}
             style="width:95%; background: linear-gradient(135deg, #9333EA 0%, #7E22CE 100%);"
            {% else %}
           style="width:99%; background: linear-gradient(135deg, #111827 0%, #1F2937 100%);"
            {% endif %}></div>
        </div>
        <p class="text-gray-500 mt-2 dark:text-gray-400"> Lowest on {{ avg_3card_dict['best_aqi'] }}</p>
        <div class="flex justify-between text-xs text-gray-500 mt-1 dark:text-gray-400">
         
        </div>
      </div>
    </div>

    <!-- 7-DAY FORECAST - FULL WIDTH CARD -->
    <div class="bg-white rounded-2xl shadow-lg mb-6 p-6 animate-fadeIn hover-lift dark:bg-gray-800">
      <h4 class="text-xl font-semibold mb-4 text-center flex items-center justify-center">
        <i class="fas fa-calendar-alt mr-2 text-indigo-600 dark:text-indigo-400"></i> 7-Day Forecast
      </h4>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-7 gap-4">
        {% for i in range(7)%}
        {% set aqi=passing_data[i]["value"] %}

        <div class="forecast-day bg-gray-50 p-4 rounded-xl shadow text-center cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-lg animate-fadeIn dark:bg-gray-700">
          <h6 class="font-medium">{{ passing_data[i]["date"] }}</h6>
<p class="aqi-value text-2xl font-extrabold bg-clip-text 
  {% if aqi <= 50 %} text-green-500
  {% elif aqi <= 100 %} text-yellow-500
  {% elif aqi <= 200 %} text-orange-500
  {% else %} text-red-600
  {% endif %}">
  {{ aqi }}
</p>
          <small class="text-gray-500 dark:text-gray-400">
              {% if aqi <= 50 %} Good
              {% elif aqi <= 100 %} Moderate
              {% elif aqi <= 200 %} Unhealthy
              {% else %} Very Unhealthy
              {% endif %}
            </small>          
            <div class="mt-2 text-xs text-gray-400 dark:text-gray-500">PM2.5:-{{passing_pollutant[i]['value']}}
               
            </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- AQI TABLE -->
    <h4 class="text-xl font-semibold mb-4 animate-fadeIn flex items-center">
      <i class="fas fa-table mr-2 text-indigo-600 dark:text-indigo-400"></i> Pollutant Details
    </h4>
    <div class="table-responsive overflow-x-auto bg-white rounded-2xl shadow-lg animate-fadeIn hover-lift dark:bg-gray-800">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-50 dark:bg-gray-700">
          <tr>
            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider dark:text-gray-300">Pollutant</th>
            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider dark:text-gray-300">Value (Œºg/m¬≥)</th>
            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider dark:text-gray-300">Percentage of Standard</th>
            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider dark:text-gray-300">Status</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700">
  {% for pollutant in pollutants %}
  <tr class="{% if loop.index % 2 == 0 %}bg-gray-50 hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600{% else %}hover:bg-gray-50 dark:hover:bg-gray-700{% endif %} transition-colors">
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">
      {{ pollutant.name }}
    </td>
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">
      {{ pollutant.value }}
    </td>
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">
      <div>{{ pollutant.percentage }}%</div>
      <div class="pollutant-bar h-2 bg-gray-200 rounded-full mt-1 overflow-hidden dark:bg-gray-700">
<div class="pollutant-fill h-full rounded-full {{ pollutant.class }}" 
     style="width: {{ pollutant.percentage }}%;">
</div>
      </div>
    </td>
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">
      <span class="status-indicator w-3 h-3 rounded-full {{ pollutant.color }} inline-block mr-2"></span>
      {{ pollutant.status }}
    </td>
  </tr>
  {% endfor %}
</tbody>


      </table>
    </div>

    <!-- FORECAST + HISTORICAL GRAPHS -->
  <div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
            <div class="forecast-card bg-white rounded-2xl shadow-lg p-6 animate-fadeIn hover-lift dark:bg-gray-800">
        <h5 class="text-lg font-semibold mb-4 flex items-center">
          <i class="fas fa-chart-line mr-2 text-indigo-600 dark:text-indigo-400"></i>
          7-Day Graphical Forecast
        </h5>
        <!-- <div class="forecast-chart" id="forecast-chart" > -->
          {{ graph_html | safe }}
        <!-- </div> -->
      </div>

      <div class="forecast-card bg-white rounded-2xl shadow-lg p-6 animate-fadeIn hover-lift dark:bg-gray-800">
        <h5 class="text-lg font-semibold mb-4 flex items-center">
          <i class="fas fa-history mr-2 text-indigo-600 dark:text-indigo-400"></i> Historical Trends
        </h5>
        <div class="historical-chart" id="historical-chart">
          {{avg_graph|safe}}
        </div>
      </div>
    </div>

    <!-- ADVISORY -->
    <div class="card mt-6 bg-green-50 border-l-4 border-green-500 p-6 rounded-2xl animate-fadeIn hover-lift dark:bg-green-900 dark:bg-opacity-20 dark:border-green-400">
      <h5 class="text-lg font-semibold mb-2 flex items-center">
        <i class="fas fa-heart mr-2 text-green-600 dark:text-green-400"></i> ‚úÖ Health Advisory
      </h5>
      <p class="text-gray-700 dark:text-gray-300">{{health_alert}}</div>
  </div>
</div>

</div>




<script>
  // Toggle open
  document.getElementById('chatbot-toggle').addEventListener('click', function() {
    document.getElementById('chatbot-modal').classList.toggle('hidden');
  });

  // Close chatbot
  document.getElementById('chatbot-close').addEventListener('click', function() {
    document.getElementById('chatbot-modal').classList.add('hidden');
  });
</script>


  
{% endblock %}